<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fake News Detector | MLOps Thesis</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="dashboard">
        <header>
            <h1><i class="fa-solid fa-shield-halved"></i> Political Fake News Detector</h1>
            <p>Master's Thesis | Işık Üniversitesi | Eyüpsultan, Istanbul</p>
        </header>

        <section class="status-bar">
            <div class="status-item">
                <i class="fa-solid fa-calendar-check"></i>
                <span>Last Automation Sync: <strong>{{ last_scrape }}</strong></span>
            </div>
            <div class="status-item">
                <i class="fa-solid fa-heart-pulse"></i>
                <span>Model Health: <strong class="badge {{ model_status.lower() }}">{{ model_status }}</strong></span>
            </div>
        </section>
        
        <main>
            <div class="input-card">
                <h2>Paste News Headline</h2>
                <textarea id="tweetInput" placeholder="Enter a headline or tweet to verify..."></textarea>
                <button id="analyzeBtn" onclick="analyzeTweet()">Run CNN Analysis</button>
            </div>

            <div class="result-card" id="resultCard" style="display: none;">
                <div id="verdictLabel" class="verdict"></div>
                <div class="confidence-gauge">
                    <label>Confidence: <span id="confidenceValue"></span></label>
                    <div class="progress-bar"><div id="confidenceFill" class="progress-fill"></div></div>
                </div>
                <p><strong>Processed Text:</strong> <em id="cleanedText"></em></p>
            </div>
        </main>
    </div>

    <script>
        async function analyzeTweet() {
            const text = document.getElementById('tweetInput').value;
            if (!text.trim()) return;

            const resCard = document.getElementById('resultCard');
            const btn = document.getElementById('analyzeBtn');
            btn.disabled = true;
            btn.innerText = "Processing...";

            const response = await fetch('/predict', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ text: text })
            });
            const data = await response.json();

            resCard.style.display = 'block';
            document.getElementById('verdictLabel').innerText = data.verdict;
            document.getElementById('verdictLabel').className = 'verdict ' + data.verdict.replace(" ", "-").toLowerCase();
            document.getElementById('confidenceValue').innerText = (data.confidence * 100).toFixed(2) + "%";
            document.getElementById('confidenceFill').style.width = (data.confidence * 100) + "%";
            document.getElementById('cleanedText').innerText = data.cleaned_text;
            
            btn.disabled = false;
            btn.innerText = "Run CNN Analysis";
        }
    </script>
</body>
</html>